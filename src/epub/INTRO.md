# Vue.jsのデザインパターン－メンテナンス性に優れたアプリケーションのためのテスト駆動アプローチ

## イントロダクション

*デザインパターン*のように抽象度が高いものに関心があるのですから、読者は一定期間のコーディング経験を持ち、フロントエンド開発に関心をお持ちのことでしょう。JQueryを用いたインターフェース開発の経験をお持ちかもしれません。JQueryはとても優れたものでしたが、時は流れ、要求される内容も変わっていきました。当時はメンテナンス性に優れたJQueryのコードベースは、どんどん混沌としたものになってしまいました。

ここに至って、あなたは代替となるものを見つけようとしたかもしれません。ReactやVueは、その際の典型的な次のステップでしょう。－コンポーネント！カプセル化！単体テスト！`vue create app`すれば、すべては完璧です！

再び、時は流れ－要求される内容も、再び変わりました。状況は再び混沌としてきています。今回の混沌は少しは整理されたもので、混沌の極みというほどの状況ではなくなりました。しかし、物事が*正しい*状態にあるとは言えません。コンポーネントは巨大化していき（通称"God Component"と呼ばれます）、コードは1000行に達する程になっているかもしれません。データの取得やバリデーション、その他想像しうる全てを、一つのコンポーネントの中でやろうとしています。数十のpropsを下位に渡し、数十のイベントを上位にemitし返す、といったことは当たり前になっています。"信頼できる唯一の情報源"は、"信頼できるいくつもの情報源"になりつつあります。ビジネスロジック（つまり、解決するべき問題）と見た目に関する要素の境界線は曖昧になり始めました。結果、開発スピードは低下し、見つけづらいバグが忍び寄り始めます。

数年後、初期の開発者は全員いなくなりました。どのようにアプリが動作しているのか、あるいは`// TODO: fix this`が、実際のところ何について言及しているのか、本当に理解している人は誰もいません。企業は大規模な改修を選択せざるをえなくなり、同じ過ちが繰り返されます。

*実際のところ、これはよくあることです*。結局のところ、JQueryが問題ではなかったのでしょうか？

こんなはずではなかったのに！Vueはパワフルで柔軟性の高いUIレイヤーであり、JavaScript（及びTypeScript）は毎年改善しており、Jestは最高のテストランナーです。信頼性とメンテナンス性に優れたバグフリーなアプリケーションに必要な全てのツールは揃っています。見落とされがちなのは、デザインパターンやベストプラクティス、適切な関心の分離、そして信頼性の高いテストスイートです。これらは、全てのソフトウェア開発を支える基礎的なアイデアで、フロントエンド・アプリケーションに限った話ではありません。

## この本について

この本はデザインパターンとテストについての書籍です。しかし、それ以上の内容も含んでいます。デザインパターンについて考えるということは、そこに登場する抽象的な命名や図解について多くを記憶する、ということではありません。どのようにテストするかを知るというのは、本来テストランナーを学んだり、ドキュメントを読むことではありません。

デザインパターンについて考え、システムの異なる部分間のデータの流れについて考慮し、テスト容易性のために記述することは、いかなるコードの記述に*先立つ*ものです。

優れたソフトウェアデザインとは、一種の哲学です。一種の生き方とも言えます。最終的には、良いソフトウェアを書くことは一人のエンジニアとしてのあなたの*仕事*です。テスト容易性の高いコードを書くことも同様です－仮に人事部があなたの職務経歴書にそのことを書くことを忘れたとしても。

本書のゴールは読者に、テスト容易性の高いコードを書き、問題解決のための正しい抽象化を選択する習慣を身につけてもらうことです。ビジネス上の新しい要求や要望を聞いた際にあなたが一番に考えるべきことは以下のようなことです：
\newline
\newline －どのデザインパターンが将来的に最も柔軟性が高いものとなるか？
\newline －どのような新しい要求が出てきうるか、その際、この要求を今回の決定がどのように対処できるのだろうか？
\newline －どのようにしてテスト容易性が高く、疎結合な方法でコードを書いていくのか？

これからお伝えするレッスンやデザインパターンはVueに限った話では全くありません。それらはフレームワークを問わないものです。もっと言えばそれらはプログラミング言語すら問いません。それらはどこでも通用するもので、どのようなソフトウェアデザインにも当てはめることができます。良い開発者はツールやフレームワークにフォーカスを当てます。偉大な開発者はデータ構造やそれらが相互にどのように影響しあうか、テスト容易性、メンテナンス性にフォーカスを当てます。

本書の全ての内容はもちろん、私の意見に基づいています。ほとんどのベストプラクティスやデザインパターンがそうであるように、物事には時と場合があり、全ての推奨が全てのユースケースに当てはまるというわけではありません。この本の価値を最大化する方法は、サンプルコードを読み、コンセプトについて考え、それをあなたが現在やっていることと比較することです。

もしそれがあなたの抱える問題を解決してくれると思うなら、実際に試してみて何が起こるか確かめてみて下さい。例外というものは常にありますが、最も重要なことは、自分自身で関心の分離、テスト容易性、可読性といった問題を考えることです。何か同意できない部分があれば、議論や改善に対して、私はいつでもオープンです。ぜひ連絡をください。新しい視点やアイデアというものに、いつでも関心があります。

## 本書で期待されること

フレームワークやプログラミング言語、テストを教える大抵の書籍は、1つ又は2つのアプリを作成し、段階的にそこに新しい機能を追加していくという形式であることが多いです。この方法は新しい言語やフレームワークを学ぶ上では非常にうまく機能しますが、コンセプトやアイデアに焦点を当てる理想的な方法ではありません。本書においては、各章は一つのアイデアに焦点を当て、それを説明するための小規模なコンポーネント、あるいはアプリケーションを開発します。このアプローチにはいくつかの利点があります。本書をどのような順番で読むこともできますし、ある種のリファレンスとして使うこともできます。

本書では、まず`props`のデザインパターンから始めます。それと同時に、本書の最も基礎的なアイデアの一つである*関心の分離*についても論じます。その後、events、forms、components、renderless components、そしてComposition APIを用いた機能の分離に関する幅広いデザインパターンや、他にも技術的に優れたVue.jsアプリケーションを作るうえで知っておくべきことを論じていきます。

ほとんどの章の最後には複数のエクササイズがあり、その章で学んだことをより深く理解し練習することができます。エクササイズの全ての解答を含むソースコードは[こちらで参照できます](https://github.com/lmiller1990/design-patterns-for-vuejs-source-code): (https://github.com/lmiller1990/design-patterns-for-vuejs-source-code)ので、自分の回答が正しかったかを確認できます。

それぞれの章は独立していますので、順番に読む必要はありません。関心がある特定の章がありましたら、遠慮なくそこまでスキップしてください。本書をある種のレファレンスツールとして考えてください。読者が何年にも渡って本書に立ち帰り、その都度何か有益なことを学んでいただければ幸いです。

本書が読者の期待する内容に沿うものであることを願っています。なにかフィードバック、質問、コメント等ありましたら、または単にVueやテストについて私と話したいという場合であっても、気軽にemailやTwitterでご連絡ください（最新の連絡先の詳細については、本書に記載のウェブサイトをご確認ください）※。

※【訳者註】本書は英語の原書を翻訳したものであり、作者はオーストラリア人です。ご連絡は可能かと思いますが、英語にてお願いいたします。

それでは、次の章でお会いしましょう！

## 訳者補足

日本の読者にとってなじみが薄いと思われる用語については、【訳者註】を記載しておりますので、ご参照ください。

また、可読性のために、ソースコード内のコメント及びテストにおけるアサートは日本語に訳しておりますが、オリジナルのソースコード上は英語のままですので、ご了承ください。

